## WAF Rule Update Proposal

This proposal was automatically generated by Blastauri based on vulnerability analysis.

**Provider:** {{ provider }}
**Generated:** {{ generated_at }}

---

{% if new_rules %}
### New Rules

The following WAF rules are proposed to protect against detected vulnerabilities:

| Rule ID | CVEs | Package | Mode |
|---------|------|---------|------|
{% for rule in new_rules %}
| `{{ rule.rule_id }}` | {{ rule.cve_ids | join(', ') }} | {{ rule.package }} | {{ rule.mode }} |
{% endfor %}

{% for rule in new_rules %}
<details>
<summary><strong>{{ rule.rule_id }}</strong> - {{ rule.cve_ids | join(', ') }}</summary>

**Triggered by:** `{{ rule.package }}@{{ rule.version }}` ({{ rule.ecosystem }})

**Reason:** {{ rule.reason }}

**CVE Details:**
{% for cve_id in rule.cve_ids %}
- [{{ cve_id }}](https://nvd.nist.gov/vuln/detail/{{ cve_id }})
{% endfor %}

</details>
{% endfor %}

{% endif %}

{% if obsolete_rules %}
### Obsolete Rules

The following rules are no longer needed and will be removed:

| Rule ID | CVEs | Reason |
|---------|------|--------|
{% for rule in obsolete_rules %}
| `{{ rule.rule_id }}` | {{ rule.cve_ids | join(', ') }} | {{ rule.reason }} |
{% endfor %}

{% endif %}

{% if promotion_candidates %}
### Promotion Candidates

The following rules have been in log mode for {{ promotion_days }}+ days and are ready for promotion to block mode:

| Rule ID | CVEs | Created | Days Active |
|---------|------|---------|-------------|
{% for rule in promotion_candidates %}
| `{{ rule.rule_id }}` | {{ rule.cve_ids | join(', ') }} | {{ rule.created_at }} | {{ rule.days_active }} |
{% endfor %}

**Recommendation:** Review WAF logs to verify these rules are not blocking legitimate traffic, then promote to block mode.

{% endif %}

{% if unchanged_rules %}
### Active Rules (Unchanged)

{{ unchanged_rules | length }} existing rule(s) remain active and unchanged.

{% endif %}

---

### Summary

| Category | Count |
|----------|-------|
| New Rules | {{ new_rules | length }} |
| Obsolete Rules | {{ obsolete_rules | length }} |
| Promotion Candidates | {{ promotion_candidates | length }} |
| Unchanged Rules | {{ unchanged_rules | length }} |
| **Total Active Rules** | {{ (new_rules | length) + (unchanged_rules | length) }} |

---

### Terraform Changes

{% if terraform_files %}
The following Terraform files have been modified:

{% for file in terraform_files %}
- `{{ file }}`
{% endfor %}
- `.blastauri/waf-state.json`

#### Validation

```bash
cd {{ terraform_dir }} && terraform init && terraform validate
```

#### Plan

```bash
terraform plan
```

{% else %}
No Terraform changes required.
{% endif %}

---

### Review Checklist

Before approving this proposal:

- [ ] Verify WAF rule patterns match the vulnerability
- [ ] Check that rules will not block legitimate traffic
- [ ] Review Terraform plan output
- [ ] Test rules in staging environment
- [ ] Confirm monitoring is in place for new rules

---

### CVE Coverage Summary

{% if all_cves %}
| CVE ID | Severity | Package | WAF Rule |
|--------|----------|---------|----------|
{% for cve in all_cves %}
| [{{ cve.cve_id }}](https://nvd.nist.gov/vuln/detail/{{ cve.cve_id }}) | {{ cve.severity }} | {{ cve.package }} | {% if cve.has_rule %}{{ cve.rule_id }}{% else %}N/A{% endif %} |
{% endfor %}
{% else %}
No CVEs currently covered by WAF rules.
{% endif %}

---

*Generated by [Blastauri](https://github.com/clay-good/blastauri)*
